import{q as C,s as k,_ as N,r as y,e as T,u as D,d as A,w as W,c as x,a as o,h,v as b,f as B,F as w,g as E,o as v,b as H,t as S}from"./index-BXrlFa4x.js";var M=C({name:"VueDrawingCanvas",props:{strokeType:{type:String,validator:i=>["dash","line","square","circle","triangle","half_triangle"].indexOf(i)!==-1,default:()=>"dash"},fillShape:{type:Boolean,default:()=>!1},width:{type:[String,Number],default:()=>600},height:{type:[String,Number],default:()=>400},image:{type:String,default:()=>""},eraser:{type:Boolean,default:()=>!1},color:{type:String,default:()=>"#000000"},lineWidth:{type:Number,default:()=>5},lineCap:{type:String,validator:i=>["round","square","butt"].indexOf(i)!==-1,default:()=>"round"},lineJoin:{type:String,validator:i=>["miter","round","bevel"].indexOf(i)!==-1,default:()=>"miter"},lock:{type:Boolean,default:()=>!1},styles:{type:[Array,String,Object]},classes:{type:[Array,String,Object]},backgroundColor:{type:String,default:()=>"#FFFFFF"},backgroundImage:{type:String,default:()=>null},watermark:{type:Object,default:()=>null},saveAs:{type:String,validator:i=>["jpeg","png"].indexOf(i)!==-1,default:()=>"png"},canvasId:{type:String,default:()=>"VueDrawingCanvas"},initialImage:{type:Array,default:()=>[]},additionalImages:{type:Array,default:()=>[]},outputWidth:{type:Number},outputHeight:{type:Number}},data(){return{loadedImage:null,drawing:!1,context:null,images:[],strokes:{type:"",from:{x:0,y:0},coordinates:[],color:"",width:"",fill:!1,lineCap:"",lineJoin:""},guides:[],trash:[]}},mounted(){this.setContext(),this.$nextTick(()=>{this.drawInitialImage(),this.drawAdditionalImages()})},watch:{backgroundImage:function(){this.loadedImage=null}},methods:{async setContext(){let i=document.querySelector("#"+this.canvasId);this.context=this.context?this.context:i.getContext("2d"),await this.setBackground()},drawInitialImage(){this.initialImage&&this.initialImage.length>0&&(this.images=[].concat(this.images,this.initialImage),this.redraw(!0))},drawAdditionalImages(){if(this.additionalImages&&this.additionalImages.length>0){let i=document.querySelector("#"+this.canvasId);this.additionalImages.forEach(e=>{this.drawWatermark(i,this.context,e)})}},clear(){this.context.clearRect(0,0,Number(this.width),Number(this.height))},async setBackground(){this.clear(),this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,Number(this.width),Number(this.height)),await this.$nextTick(async()=>{await this.drawBackgroundImage()}),this.save()},async drawBackgroundImage(){if(this.loadedImage)this.context.drawImage(this.loadedImage,0,0,Number(this.width),Number(this.height));else return new Promise(i=>{if(!this.backgroundImage){i();return}const e=new Image;e.src=this.backgroundImage,e.onload=()=>{this.context.drawImage(e,0,0,Number(this.width),Number(this.height)),this.loadedImage=e,i()}})},getCoordinates(i){let e,t;if(i.touches&&i.touches.length>0){let r=document.querySelector("#"+this.canvasId).getBoundingClientRect();e=i.touches[0].clientX-r.left,t=i.touches[0].clientY-r.top}else e=i.offsetX,t=i.offsetY;return{x:e,y:t}},startDraw(i){if(!this.lock){this.drawing=!0;let e=this.getCoordinates(i);this.strokes={type:this.eraser?"eraser":this.strokeType,from:e,coordinates:[],color:this.eraser?this.backgroundColor:this.color,width:this.lineWidth,fill:this.eraser||this.strokeType==="dash"||this.strokeType==="line"?!1:this.fillShape,lineCap:this.lineCap,lineJoin:this.lineJoin},this.guides=[]}},draw(i){if(this.drawing){this.context||this.setContext();let e=this.getCoordinates(i);if(this.eraser||this.strokeType==="dash")this.strokes.coordinates.push(e),this.drawShape(this.context,this.strokes,!1);else{switch(this.strokeType){case"line":this.guides=[{x:e.x,y:e.y}];break;case"square":this.guides=[{x:e.x,y:this.strokes.from.y},{x:e.x,y:e.y},{x:this.strokes.from.x,y:e.y},{x:this.strokes.from.x,y:this.strokes.from.y}];break;case"triangle":let t=Math.floor((e.x-this.strokes.from.x)/2)<0?Math.floor((e.x-this.strokes.from.x)/2)*-1:Math.floor((e.x-this.strokes.from.x)/2),a=this.strokes.from.x<e.x?this.strokes.from.x+t:this.strokes.from.x-t;this.guides=[{x:e.x,y:this.strokes.from.y},{x:a,y:e.y},{x:this.strokes.from.x,y:this.strokes.from.y}];break;case"half_triangle":this.guides=[{x:e.x,y:this.strokes.from.y},{x:this.strokes.from.x,y:e.y},{x:this.strokes.from.x,y:this.strokes.from.y}];break;case"circle":let r=this.strokes.from.x-e.x<0?(this.strokes.from.x-e.x)*-1:this.strokes.from.x-e.x;this.guides=[{x:this.strokes.from.x>e.x?this.strokes.from.x-r:this.strokes.from.x+r,y:this.strokes.from.y},{x:r,y:r}];break}this.drawGuide(!0)}}},drawGuide(i){this.redraw(!0),this.$nextTick(()=>{this.context.strokeStyle=this.color,this.context.lineWidth=1,this.context.lineJoin=this.lineJoin,this.context.lineCap=this.lineCap,this.context.beginPath(),this.context.setLineDash([15,15]),this.strokes.type==="circle"?this.context.ellipse(this.guides[0].x,this.guides[0].y,this.guides[1].x,this.guides[1].y,0,0,Math.PI*2):(this.context.moveTo(this.strokes.from.x,this.strokes.from.y),this.guides.forEach(e=>{this.context.lineTo(e.x,e.y)}),i&&this.context.closePath()),this.context.stroke()})},drawShape(i,e,t){i.strokeStyle=e.color,i.fillStyle=e.color,i.lineWidth=e.width,i.lineJoin=e.lineJoin===void 0?this.lineJoin:e.lineJoin,i.lineCap=e.lineCap===void 0?this.lineCap:e.lineCap,i.beginPath(),i.setLineDash([]),e.type==="circle"?i.ellipse(e.coordinates[0].x,e.coordinates[0].y,e.coordinates[1].x,e.coordinates[1].y,0,0,Math.PI*2):(i.moveTo(e.from.x,e.from.y),e.coordinates.forEach(a=>{i.lineTo(a.x,a.y)}),t&&i.closePath()),e.fill?i.fill():i.stroke()},stopDraw(){this.drawing&&(this.strokes.coordinates=this.guides.length>0?this.guides:this.strokes.coordinates,this.images.push(this.strokes),this.redraw(!0),this.drawing=!1,this.trash=[])},reset(){this.lock||(this.images=[],this.strokes={type:"",coordinates:[],color:"",width:"",fill:!1,lineCap:"",lineJoin:""},this.guides=[],this.trash=[],this.redraw(!0))},undo(){if(!this.lock){let i=this.images.pop();i&&(this.trash.push(i),this.redraw(!0))}},redo(){if(!this.lock){let i=this.trash.pop();i&&(this.images.push(i),this.redraw(!0))}},async redraw(i){i=typeof i<"u"?i:!0,await this.setBackground().then(()=>{this.drawAdditionalImages()}).then(()=>{let e=document.createElement("canvas"),t=e.getContext("2d");e.width=Number(this.width),e.height=Number(this.height),t&&(this.images.forEach(a=>{t&&(t.globalCompositeOperation=a.type==="eraser"?"destination-out":"source-over",(a.type!=="circle"||a.type==="circle"&&a.coordinates.length>0)&&this.drawShape(t,a,!(a.type==="eraser"||a.type==="dash"||a.type==="line")))}),this.context.drawImage(e,0,0,Number(this.width),Number(this.height)))}).then(()=>{i&&this.save()})},wrapText(i,e,t,a,r,l){const f=/(\r\n|\n\r|\n|\r)+/g,u=/\s+/g;var p=e.split(f).filter(m=>m.length>0);for(let m=0;m<p.length;m++){for(var g=p[m].split(u).filter(I=>I.length>0),c="",n=0;n<g.length;n++){var s=c+g[n]+" ",d=i.measureText(s),_=d.width;_>r&&n>0?(this.watermark&&this.watermark.fontStyle&&this.watermark.fontStyle.drawType&&this.watermark.fontStyle.drawType==="stroke"?i.strokeText(c,t,a):i.fillText(c,t,a),c=g[n]+" ",a+=l):c=s}this.watermark&&this.watermark.fontStyle&&this.watermark.fontStyle.drawType&&this.watermark.fontStyle.drawType==="stroke"?i.strokeText(c,t,a):i.fillText(c,t,a),a+=g.length>0?l:0}},save(){let i=document.querySelector("#"+this.canvasId);if(this.watermark){let e=document.createElement("canvas"),t=e.getContext("2d");t&&(e.width=Number(this.width),e.height=Number(this.height),t.drawImage(i,0,0,Number(this.width),Number(this.height)),this.drawWatermark(e,t,this.watermark))}else{let e=document.createElement("canvas"),t=e.getContext("2d"),a=this.outputWidth===void 0?this.width:this.outputWidth,r=this.outputHeight===void 0?this.height:this.outputHeight;if(e.width=Number(a),e.height=Number(r),t)return t.drawImage(i,0,0,Number(a),Number(r)),this.$emit("update:image",e.toDataURL("image/"+this.saveAs,1)),e.toDataURL("image/"+this.saveAs,1)}},drawWatermark(i,e,t){if(t.type==="Image"){let a=t.imageStyle?t.imageStyle.width?t.imageStyle.width:Number(this.width):Number(this.width),r=t.imageStyle?t.imageStyle.height?t.imageStyle.height:Number(this.height):Number(this.height);const l=new Image;l.src=t.source,l.onload=()=>{t&&e&&e.drawImage(l,t.x,t.y,Number(a),Number(r));let f=document.createElement("canvas"),u=f.getContext("2d"),p=this.outputWidth===void 0?this.width:this.outputWidth,g=this.outputHeight===void 0?this.height:this.outputHeight;if(f.width=Number(p),f.height=Number(g),u)return u.drawImage(i,0,0,Number(p),Number(g)),this.$emit("update:image",f.toDataURL("image/"+this.saveAs,1)),f.toDataURL("image/"+this.saveAs,1)}}else if(t.type==="Text"){let a=t.fontStyle&&t.fontStyle.font?t.fontStyle.font:"20px serif",r=t.fontStyle&&t.fontStyle.textAlign?t.fontStyle.textAlign:"start",l=t.fontStyle&&t.fontStyle.textBaseline?t.fontStyle.textBaseline:"alphabetic",f=t.fontStyle&&t.fontStyle.color?t.fontStyle.color:"#000000";if(e.font=a,e.textAlign=r,e.textBaseline=l,t.fontStyle&&t.fontStyle.rotate){let n,s;t.fontStyle&&t.fontStyle.width?n=t.x+Math.floor(t.fontStyle.width/2):n=t.x,t.fontStyle&&t.fontStyle.lineHeight?s=t.y+Math.floor(t.fontStyle.lineHeight/2):s=t.y,e.translate(n,s),e.rotate(t.fontStyle.rotate*Math.PI/180),e.translate(n*-1,s*-1)}t.fontStyle&&t.fontStyle.drawType&&t.fontStyle.drawType==="stroke"?(e.strokeStyle=t.fontStyle.color,t.fontStyle&&t.fontStyle.width?this.wrapText(e,t.source,t.x,t.y,t.fontStyle.width,t.fontStyle.lineHeight):e.strokeText(t.source,t.x,t.y)):(e.fillStyle=f,t.fontStyle&&t.fontStyle.width?this.wrapText(e,t.source,t.x,t.y,t.fontStyle.width,t.fontStyle.lineHeight):e.fillText(t.source,t.x,t.y));let u=document.createElement("canvas"),p=u.getContext("2d"),g=this.outputWidth===void 0?this.width:this.outputWidth,c=this.outputHeight===void 0?this.height:this.outputHeight;if(u.width=Number(g),u.height=Number(c),p)return p.drawImage(i,0,0,Number(g),Number(c)),this.$emit("update:image",u.toDataURL("image/"+this.saveAs,1)),u.toDataURL("image/"+this.saveAs,1)}},isEmpty(){return!(this.images.length>0)},getAllStrokes(){return this.images}},render(){return k("canvas",{id:this.canvasId,height:Number(this.height),width:Number(this.width),style:{touchAction:"none",...this.styles},class:this.classes,onMousedown:i=>this.startDraw(i),onMousemove:i=>this.draw(i),onMouseup:()=>this.stopDraw(),onMouseleave:()=>this.stopDraw(),onTouchstart:i=>this.startDraw(i),onTouchmove:i=>this.draw(i),onTouchend:()=>this.stopDraw(),onTouchleave:()=>this.stopDraw(),onTouchcancel:()=>this.stopDraw(),onPointerdown:i=>this.startDraw(i),onPointermove:i=>this.draw(i),onPointerup:()=>this.stopDraw(),onPointerleave:()=>this.stopDraw(),onPointercancel:()=>this.stopDraw()})}});const z={class:"drawingBoard"},R={class:"options"},L={class:"background but"},P={class:"back__file-inp"},F={class:"eraser"},J=["checked"],V={class:"size_range"},O=["value"],q={class:"actions"},U={class:"actions__content"},$={class:"action"},j={class:"action__coordinate",style:{display:"flex"}},X={class:"action__data"},Y={__name:"game_field",setup(i){let e=y(),t=y();T(()=>{console.log(t.value),e.value=t.value.getAllStrokes(),console.log(e.value)}),y();let a=D(),r=y("");y(5),console.log(r);let l=A({colorpicker:"000",sizepicker:5,width:400,height:500,isEraser:!1,background_image:""});W(l.isEraser,n=>{console.log(n)});function f(){t.value.reset()}function u(n){let s=new FileReader,d=n.target.files[0];s.readAsDataURL(d),s.onload=function(){console.log(s.result),l.background_image=s.result},s.onerror=function(){console.log(s.error)}}function p(){var n=t.value.save();let s={img:n,metadata:{user:"andrey",date_create:new Date().toISOString()}};a.addImage(s),console.log(s)}function g(n){console.log(t.value.getAllStrokes())}function c(n){console.log(n)}return(n,s)=>(v(),x(w,null,[o("div",z,[o("div",R,[o("div",{class:"reset__but but",onClick:f}),o("div",L,[s[3]||(s[3]=o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",class:"bi bi-image",viewBox:"0 0 16 16"},[o("path",{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"}),o("path",{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"})],-1)),o("div",P,[o("input",{accept:"image/png",type:"file",name:"",id:"file",onInput:u},null,32)])])]),o("nav",null,[o("input",{type:"color",onChange:s[0]||(s[0]=d=>h(l).colorpicker=d.target.value),class:"nav__par color-input",id:"colorpicker"},null,32),o("div",F,[o("input",{type:"checkbox",class:"nav__par Eraser",onInput:s[1]||(s[1]=d=>h(l).isEraser=d.target.checked),checked:h(l).isEraser,name:"eraser",id:"eraser"},null,40,J),s[4]||(s[4]=o("label",{for:"eraser"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fill:"currentColor",class:"bi bi-eraser-fill",viewBox:"0 0 16 16"},[o("path",{d:"M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293z"})])],-1))]),o("div",V,[o("input",{type:"range",class:"nav__par",min:"1",max:"20",onChange:s[2]||(s[2]=d=>h(l).sizepicker=d.target.value),value:h(l).sizepicker},null,40,O),o("div",{class:"demo-size nav__par",style:b({width:h(l).sizepicker+"px",height:h(l).sizepicker+"px","border-radius":"50%","background-color":"#fff",margin:"30pxauto"})},null,4)])]),B(h(M),{ref_key:"VueCanvas",ref:t,class:"canvas",color:h(l).colorpicker,strokeType:"dash",lineWidth:h(l).sizepicker,width:h(l).width,height:h(l).height,eraser:h(l).isEraser,backgroundImage:h(l).background_image,onStartDraw:c},null,8,["color","lineWidth","width","height","eraser","backgroundImage"])]),o("div",{class:"option"},[o("div",{class:"but option__but save",onClick:p},"save"),o("div",{class:"but option__but share",onClick:g},"share")]),o("div",q,[s[6]||(s[6]=o("div",{style:{"font-size":"1.5em","font-weight":"600"}},"Actions",-1)),o("div",U,[o("ul",null,[(v(!0),x(w,null,E(h(e),d=>(v(),x("li",{key:d.id},[o("div",$,[o("div",j,[s[5]||(s[5]=o("span",{style:{"font-weight":"bold","font-size":"1.2em"}},"from: ",-1)),H(" "+S(d.from.x.toFixed(0))+", "+S(d.from.y.toFixed(0)),1)]),o("div",X,[o("div",{class:"data__color",style:b([{width:"40px",height:"40px",margin:"10px","border-radius":"7px"},{backgroundColor:d.color}])},null,4)])])]))),128))])])])],64))}},K=N(Y,[["__scopeId","data-v-2db3d820"]]);export{K as default};
